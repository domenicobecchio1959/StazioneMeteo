<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meteo Live</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
    font-size: 28px;
    background: #f2f2f2;
  }
  h1 {
    font-size: 40px;
    margin-bottom: 10px;
  }
  .value {
    font-size: 48px;
    font-weight: bold;
    margin: 10px 0;
  }
  .label {
    font-size: 24px;
    color: #555;
  }
  .small {
    font-size: 22px;
    color: #444;
  }
</style>
</head>
<body>

<h1>Stazione Meteo</h1>

<div>
  <div class="label">Temperatura</div>
  <div id="temp" class="value">-- °C</div>
</div>

<div>
  <div class="label">Umidità</div>
  <div id="hum" class="value">-- %</div>
</div>

<div>
  <div class="label">Pressione</div>
  <div id="press" class="value">-- hPa</div>
</div>

<div>
  <div class="label">Vento</div>
  <div id="wind" class="value">-- m/s</div>
</div>

<div>
  <div class="label">Direzione</div>
  <div id="dir" class="value">--°</div>
  <div id="dirtext" class="small">--</div>
</div>

<div>
  <div class="label">Beaufort</div>
  <div id="beau" class="value">--</div>
</div>

<div class="label">Ultimo aggiornamento:</div>
<div id="time" class="small">--</div>

<script>
const channelID = "3214007";
const readAPI = "VCGZD38ITPCWT974";

// Direzioni vento
const WIND_DIR_TEXT = [
  "N - Tramontana","NNE - Grecale","NE - Grecale","ENE - Grecale","E - Levante",
  "ESE - Scirocco","SE - Scirocco","SSE - Scirocco","S - Ostro","SSW - Libeccio",
  "SW - Libeccio","WSW - Libeccio","W - Ponente","WNW - Maestrale",
  "NW - Maestrale","NNW - Tramontana"
];

// Scala Beaufort testuale
const BEAUFORT_TEXT = [
  "Calmo",
  "Bava di vento",
  "Brezza leggera",
  "Brezza tesa",
  "Vento moderato",
  "Vento teso",
  "Vento fresco",
  "Vento forte",
  "Burrasca",
  "Burrasca forte",
  "Tempesta",
  "Tempesta violenta",
  "Uragano"
];

function getWindDirectionIndex(gradi) {
  if (gradi >= 348 || gradi < 11) return 0;
  else if (gradi >= 11 && gradi < 33) return 1;
  else if (gradi >= 33 && gradi < 56) return 2;
  else if (gradi >= 56 && gradi < 78) return 3;
  else if (gradi >= 78 && gradi < 101) return 4;
  else if (gradi >= 101 && gradi < 123) return 5;
  else if (gradi >= 123 && gradi < 146) return 6;
  else if (gradi >= 146 && gradi < 168) return 7;
  else if (gradi >= 168 && gradi < 191) return 8;
  else if (gradi >= 191 && gradi < 213) return 9;
  else if (gradi >= 213 && gradi < 236) return 10;
  else if (gradi >= 236 && gradi < 258) return 11;
  else if (gradi >= 258 && gradi < 281) return 12;
  else if (gradi >= 281 && gradi < 303) return 13;
  else if (gradi >= 303 && gradi < 326) return 14;
  else if (gradi >= 326 && gradi < 348) return 15;
  return 0;
}

  function aggiornaDati() {
  fetch(`https://api.thingspeak.com/channels/${channelID}/feeds.json?api_key=${readAPI}&results=1`)
    .then(response => response.json())
    .then(data => {
      const feed = data.feeds[0];

      document.getElementById("temp").innerText  = feed.field1 + " °C";
      document.getElementById("hum").innerText   = feed.field2 + " %";
      document.getElementById("press").innerText = feed.field3 + " hPa";
      document.getElementById("wind").innerText  = feed.field4 + " m/s";

      const dir = parseInt(feed.field5);
      document.getElementById("dir").innerText = dir + "°";
      const dirIndex = getWindDirectionIndex(dir);
      document.getElementById("dirtext").innerText = WIND_DIR_TEXT[dirIndex];


      const beau = parseInt(feed.field6);
      document.getElementById("beau").innerText = BEAUFORT_TEXT[beau] || "--";

      // Ora locale
      const utcDate = new Date(feed.created_at);
      const localTime = utcDate.toLocaleString("it-IT", {
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      });

      document.getElementById("time").innerText = localTime;
    })
    .catch(err => console.log("Errore:", err));
}

aggiornaDati();
setInterval(aggiornaDati, 15000);
</script>

</body>
</html>














